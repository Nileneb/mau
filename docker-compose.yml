version: "3.9"
services:
  mau:
    build: .
    container_name: mau-linn-games
    ports:
      - "5500:3000"              # Host:Container
    restart: always
    # Using a named volume avoids host permission issues. If you instead want to map a host folder,
    # uncomment the bind mount below and set PUID/PGID appropriately.
    volumes:
      - mau-data:/app/data
      # - ./data:/app/data
    
    
    environment:
      - NODE_ENV=production
      - PORT=3000
      # Optional: GITHUB_TOKEN für höhere Ratenlimits (read-only PAT)
      # - GITHUB_TOKEN=ghp_xxxxx
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:3000/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

  warm-cache:
    build: .
    container_name: mau-warm-cache
    depends_on:
      - mau
    restart: always
    volumes:
      - mau-data:/app/data
    command: /bin/sh -c "while true; do HOST=http://mau:3000 /app/deploy/warm-cache.sh; sleep 3600; done"

volumes:
  mau-data:
    driver: local
